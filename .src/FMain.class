' Gambas class file

Public importe As Float
Public textboxtmp As TextBox

Public Sub Form_Open()

  Settings.Read(Me)
  ValueBoxCUOTA1.SetFocus()

End

Public Sub Form_Close()

  Settings.WRITE(Me)

End

Public Sub ValueBoxCUOTA1_KeyPress()

  If Key.Code = Key.ENTER Or Key.Code = Key.Return Or Key.Code = Key.tab Then
    textboxtmp = ValueBoxCUOTA2.Children[0]
    textboxtmp.pos = 0
    textboxtmp.SelectAll()

    ValueBoxCUOTA2.SetFocus()

    importe = Round(ValueBoxIMPORTE1.value * ValueBoxCUOTA1.value, -2)
    Try ValueBoxCuota2aCero.value = Round(importe / (importe - ValueBoxIMPORTE1.value), -2)
  Endif

End

Public Sub ValueBoxCUOTA2_KeyPress()

  If Key.Code = Key.ENTER Or Key.Code = Key.Return Or Key.Code = Key.tab Then
    RECALCULAR()
    textboxtmp = ValueBoxCUOTA1.Children[0]
    textboxtmp.pos = 0
    textboxtmp.SelectAll()

    ValueBoxCUOTA1.SetFocus()
  Endif

End

Public Sub RECALCULAR()

  ValueBoxIMPORTE1.Background = Color.white

  Try ValueBoxIMPORTE2.Value = Round(ValueBoxIMPORTE1.Value * ValueBoxCUOTA1.Value / ValueBoxCUOTA2.Value, -2)

  Try ValueBoxBENEFICIO.Value = Round(ValueBoxCUOTA1.Value * ValueBoxIMPORTE1.VALUE - ValueBoxIMPORTE2.Value - ValueBoxIMPORTE1.Value, -2)

  Try ValueBoxIMPORTE3.Value = Round(ValueBoxIMPORTE1.Value * ValueBoxCUOTA1.Value / ValueBoxCUOTA2.Value, 0)

  Try ValueBoxBENEFICIO2.Value = Round(ValueBoxCUOTA2.Value * ValueBoxIMPORTE3.VALUE - ValueBoxIMPORTE3.Value - ValueBoxIMPORTE1.Value, -2)

  Try ValueBoxBENEFICIO1redondeo.value = Round(ValueBoxCUOTA1.Value * ValueBoxIMPORTE1.VALUE - ValueBoxIMPORTE3.Value - ValueBoxIMPORTE1.Value, -2)

  If ValueBoxBENEFICIO2.Value < 0 Then

    Try ValueBoxIMPORTE3.Value = Round(ValueBoxIMPORTE1.Value * ValueBoxCUOTA1.Value / ValueBoxCUOTA2.Value, 0) + 1

    Try ValueBoxBENEFICIO2.Value = Round(ValueBoxCUOTA2.Value * ValueBoxIMPORTE3.VALUE - ValueBoxIMPORTE3.Value - ValueBoxIMPORTE1.Value, -2)

    Try ValueBoxBENEFICIO1redondeo.value = Round(ValueBoxCUOTA1.Value * ValueBoxIMPORTE1.VALUE - ValueBoxIMPORTE3.Value - ValueBoxIMPORTE1.Value, -2)

  Endif

End

Public Sub ValueBoxIMPORTE1_KeyPress()

  If Key.Code = Key.ENTER Or Key.Code = Key.Return Then
    RECALCULAR()

  Endif

End

Public Sub ValueBoxIMPORTE1_GotFocus()

  RECALCULAR()

End
